<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        .row, .container {
            display: inline;
        }
    </style>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="./assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="..\assets\img\IIUI-logo.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        SignUp-IIUI FYP Portal
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link href="../assets1/css/material-kit.css?v=2.0.6" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="../vendors/js/bootstrap.min.js"></script>
    <script src="../vendors/fontawesome-free-5.8.1-web/js/all.min.js"></script>
    <script src="../vendors/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
</head>

<body class="index-page sidebar-collapse" ng-app="myApp">
    <nav class="navbar navbar-transparent navbar-color-on-scroll fixed-top navbar-expand-lg" color-on-scroll="100" id="sectionsNav">



    </nav>

    <div class="section section-signup page-header header-filter" style="background-image: url('vendors/bg.jpg'); height:747px" ng-controller="mainControllor">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-6 ml-auto mr-auto">
                    <div class="card card-login">
                        <form class="form">
                            <div class="card-header  card-header-primary text-center" >
                                <h4 class="card-title">Sign up</h4>
                                <div class="social-line">
                                    <a href="#pablo" class="btn btn-just-icon btn-link">
                                        <i class="fa fa-facebook-square"></i>
                                    </a>

                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">

                                                </span>
                                            </div>
                                            <input type="text" class="form-control" placeholder="Name" ng-model="Name">
                                        </div>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">

                                                </span>
                                            </div>
                                            <select type="text" ng-model="Gender" id="Gender" class="result form-control" style="height:40px">
                                                <option value="" disabled selected>Gender</option>
                                                <option value="male">Male</option>
                                                <option value="female">Female</option>
                                            </select>
                                        </div>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">

                                                </span>
                                            </div>
                                            <input class="form-control" type="date" id="datepicker" width="320" ng-model="DOB">
                                        </div>


                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">

                                                </span>
                                            </div>
                                            <input type="tel" pattern="^[0][1-9]\d{9}$|^[1-9]\d{10}$" class="form-control" placeholder="Phone" ng-model="Phone">
                                        </div>

                                        

                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">

                                                </span>
                                            </div>
                                            <input type="text" class="form-control" placeholder="144/fbas/BSIT/f16" ng-model="UserName">
                                        </div>



                                    </div>

                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">

                                                </span>
                                            </div>
                                            <select type="text" class="form-control" ng-model="Department" id="Department">
                                                <option value="" disabled selected>Department</option>
                                                <option>Computer Science</option>
                                                <option>Software Engineering</option>
                                                <option>Electrical Engineering</option>
                                                <option>Civil Engineering</option>
                                                <option>Mechanical Engineering</option>
                                                <option>BioInformatics</option>
                                                <option>Mathematics</option>
                                            </select>
                                        </div>





                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">

                                                </span>
                                            </div>
                                            <input type="text" class="form-control" placeholder="Address" ng-model="Address">
                                        </div>


                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">

                                                </span>
                                            </div>
                                            <input type="email" class="form-control" id="email" placeholder="Email" ng-model="Email">
                                        </div>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">

                                                </span>
                                            </div>
                                            <input type="text" class="form-control" placeholder="CNIC 37XXX-XXXXXXX-X" ng-model="Cnic" pattern="^[0-9+]{5}-[0-9+]{7}-[0-9]{1}$">

                                        </div>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">

                                                </span>
                                            </div>
                                            <input type="password" class="form-control" placeholder="Password" ng-model="Password">
                                        </div>


                                    </div>
                                    <br />
                                    <div class="container" style="text-align:center;">
                                    <button class="btn btn-info btn-link btn-wd btn-lg" id="ButClick" value="Signup"  ng-click="Verify();"><strong>Signup</strong></button>
                                        </div>
                                </div>

                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>
        <div class="container" style="background:white;height:380px;width:300px;margin-right:300px; border-radius:7px;">
            <div class="form-group" style="text-align:center">

                <label for="image"style="cursor:pointer"><strong>Image</strong></label>
                <input type="file" id="image" class="form-control-file">
            </div>
            <div class="col-md-6" style="margin-left:40px;width:300px">
               
                <div style="height:170px; width:170px;">
                    <img type="file" src="assets/upload.jpg" id="imageprev" alt=".." class="img-thumbnail" style="height:inherit; width:inherit;">
                </div>
                <h6>
                    height:<span id="height"></span>
                    width:<span id="width"></span>
                </h6>
                <h5 id="result"></h5>
                <button class="btn btn-secondary" style="margin-left:30px;" id="upld" ng-click="uploadImage()" > <i class="fa fa-upload"></i> Upload</button>
            </div>
        </div>

    </div>

    <!--   Core JS Files   -->
 
    <script>


        $('#image').change(function () {
            $("#add").attr("disabled", false);
            var img = this.files[0];
            var reader = new FileReader;
            reader.readAsDataURL(img);
            reader.onload = function (e) {
                var file = new Image;
                file.src = e.target.result;
                file.onload = function () {
                    $("#height").text(file.height);
                    $("#width").text(file.width);
                    $("#imageprev").attr("src", file.src);
                    $("#upld").removeAttr("disabled");
                }
            }

        });
        var imgpath = "/App_Content/Images/Users/Default.jpg";
        var app = angular.module('myApp', []);

        app.controller('mainControllor', function ($scope, $http) {
            console.log("inside controllor : " + app.name);
            //this function call on signup btn click
            var grpid;
         





            $scope.uploadImage = function () {
                var file = $("#image").get(0).files;
                var data = new FormData;
                data.append("ImageFile", file[0]);
                data.append("PathtoSave", "/App_Content/Images/Users/");
                $.ajax({
                    type: "Post",
                    url: "/Test/ImageUpload",
                    data: data,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        $("#result").addClass('text-success');
                        $("#result").append(response + "image uploaded!");
                        $("#add").removeAttr("disabled");
                        imgpath = "/App_Content/Images/Users/" + response;
                    }
                });
            }

            $scope.Verify = function () {
                var onSuccess = function (data, status, headers, config) {
                    var flag = false;
                    for (var x in data) {
                        if ($scope.UserName == data[x].Regno &&  $scope.DOB == data[x].DOB) {
                            flag = true;
                            $scope.GroupID();
                            $scope.Verf();
                            
                        }
                    }
                    if (flag == false) {
                        swal({
                            text: "Regno/CNIC or DOB may be incorrect",
                            type: "warning",
                            buttons: { ok: true }
                        });
                    }
                };
                var onError = function (data, status, headers, config) {
                    console.log("error in loging in " + status);
                    swal({
                        text: "their is some error please contact webmaster",
                        type: "warning",
                        buttons: { ok: true }
                    });
                };
                var promise = $http.get('/api/Verfications');
                debugger;
                promise.success(onSuccess);
                promise.error(onError);
            }


            $scope.Verf = function () {
                var onSuccess = function (data, status, headers, config) {

                    var flag = false;
                    for (var x in data) {
                        if ($scope.UserName == data[x].UserName) {
                            flag = true;
                            swal({
                                text: "Username Already Exist!!!",
                                type: "warning",
                                buttons: { ok: true }
                            });
                        }

                    }
                        if (flag == false) {
                            
                            $scope.Signup();
                            $scope.sendmail();
                        }
                    }

                
                var onError = function (data, status, headers, config) {
                    console.log("error in loging in " + status);
                    swal({
                        text: "their is some error please contact webmaster",
                        type: "warning",
                        buttons: { ok: true }
                    });
                };
                var promise = $http.get('/api/Students');
                debugger;
                promise.success(onSuccess);
                promise.error(onError);
            };

            $scope.GroupID = function () {
                var onSuccess = function (data, status, headers, config) {
                    var flag = false;
                    for (var x in data) {
                        if ($scope.UserName == data[x].RegNo1 || $scope.UserName == data[x].RegNo2 || $scope.UserName == data[x].Regno3) {
                            flag = true;
                            grpid = data[x].Id;
                            console.log(grpid);
                            console.log("Username matched in group");
                        }

                    }
                   
                }


                var onError = function (data, status, headers, config) {
                    console.log("error in loging in " + status);
                    swal({
                        text: "their is some error please contact webmaster",
                        type: "warning",
                        buttons: { ok: true }
                    });
                };
                var promise = $http.get('/api/Groups');
                debugger;
                promise.success(onSuccess);
                promise.error(onError);
            };

            $scope.Signup = function () {
                
                var student = {
                    "Name": $scope.Name,
                    "Gender": $("#Gender option:checked").text(),
                    "DOB": $scope.DOB,
                    "Department": $("#Department option:checked").text(),
                    
                    "Address": $scope.Address,
                    "Phone": $scope.Phone,
                    
                    "UserName": $scope.UserName,
                    "Password": $scope.Password,
                    "Email": $scope.Email,
                    "ImagePath": imgpath,
                    "Cnic": $scope.Cnic,
                    "GroupId": grpid
                    
                };
                console.log(student);
               
                var onSuccess = function (data, status, headers, config) {
                    swal({
                        text: "Signup successful!",
                        type: "success",
                        buttons: { ok: true }
                    }).then(val => {
                        if (val) {
                            location.reload();
                        }
                    });
                };
                var onError = function (data, status, headers, config) {

                    swal({
                        text: "Signup unsuccessful!" + status,
                        type: "warning",
                        buttons: { ok: true }
                    });
                };
                var promise = $http.post('/api/Students', student);
                debugger;
                promise.success(onSuccess);
                promise.error(onError);
            };

   

       });

    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="assets/js/core/jquery.min.js" type="text/javascript"></script>
    <script src="assets/js/core/popper.min.js" type="text/javascript"></script>
    <script src="assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
    <script src="assets/js/plugins/moment.min.js"></script>
    <!--	Plugin for the Datepicker, full documentation here: https://github.com/Eonasdan/bootstrap-datetimepicker -->
    <script src="./assets/js/plugins/bootstrap-datetimepicker.js" type="text/javascript"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="./assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
    <!--  Google Maps Plugin    -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
    <!-- Control Center for Material Kit: parallax effects, scripts for the example pages etc -->
    <script src="assets/js/material-kit.js?v=2.0.6" type="text/javascript"></script>
    <script>
        $(document).ready(function () {
            //init DateTimePickers
            materialKit.initFormExtendedDatetimepickers();

            // Sliders Init
            materialKit.initSliders();
        });


        function scrollToDownload() {
            if ($('.section-download').length != 0) {
                $("html, body").animate({
                    scrollTop: $('.section-download').offset().top
                }, 1000);
            }
        }

    </script>

</body>

</html>
